<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        åˆ˜è®­ç¼çš„å­ç«™ğŸ 
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            RNNæˆé•¿è®°(ä¸€)ï¼šCHAR-RNNğŸ”¥
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/RNN-trip.png" alt=""></p>
<p><strong>æç¤ºï¼š</strong>å…³äº RNN çš„å†…å®¹å°†æ¨ªè·¨å¥½å‡ ç¯‡æ–‡ç« ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„ RNN ç»“æ„ã€æ”¯æŒå­—ç¬¦çº§åºåˆ—ç”Ÿæˆçš„çº¯ TensorFlow å®ç°ç­‰ç­‰ã€‚è€Œå…³äº RNN çš„åç»­æ–‡ç« ä¼šåŒ…å«æ›´å¤šé«˜çº§ä¸»é¢˜ï¼Œæ¯”å¦‚æ›´åŠ å¤æ‚çš„ç”¨äºæœºå™¨ç¿»è¯‘ä»»åŠ¡çš„ Attention æœºåˆ¶ç­‰ã€‚</p>
<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>ä½¿ç”¨å¾ªç¯ç»“æ„æ‹¥æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œæœ€çªå‡ºçš„ä¸€ä¸ªä¼˜åŠ¿å°±æ˜¯å®ƒä»¬èƒ½å¤Ÿåœ¨å†…å­˜ä¸­å­˜å‚¨å‰ä¸€ä¸ªè¾“å…¥çš„è¡¨ç¤ºã€‚å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´å¥½çš„é¢„æµ‹åç»­çš„è¾“å‡ºå†…å®¹ã€‚æŒç»­è¿½è¸ªå†…å­˜ä¸­çš„é•¿æ•°æ®æµä¼šå‡ºç°å¾ˆå¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ BPTT ç®—æ³•ä¸­å‡ºç°çš„æ¢¯åº¦æ¶ˆå¤±ï¼ˆgradient vanishingï¼‰é—®é¢˜å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¶æ„åšå‡ºä¸€äº›æ”¹è¿›æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d30342d61742d352d35342d31332d616d2e706e673f773d363230.png" alt=""></p>
<h2 id="äºŒã€CHAR-RNN"><a href="#äºŒã€CHAR-RNN" class="headerlink" title="äºŒã€CHAR-RNN"></a>äºŒã€CHAR-RNN</h2><p>æˆ‘ä»¬ä¸ä¼šå»ä¸“é—¨å®ç°ä¸€ä¸ªçº¯ TensorFlow ç‰ˆæœ¬çš„å•å­—ç¬¦ç”Ÿæˆæ¨¡å‹ã€‚ç›¸åï¼Œç°åœ¨è¿™ä¸ªæ¨¡å‹çš„ç›®æ ‡æ˜¯ä»æ¯ä¸ªè¾“å…¥å¥å­ä¸­ä»¥æ¯æ¬¡ä¸€ä¸ªå­—æ¯çš„æ–¹å¼æ¥è¯»å–å­—ç¬¦æµï¼Œå¹¶é¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œæˆ‘ä»¬å°†å¥å­ä¸­çš„å­—æ¯æä¾›ç»™ç½‘ç»œï¼Œå¹¶ç”¨äºç”Ÿæˆè¾“å‡ºçš„å­—æ¯ã€‚è€Œåœ¨æ¨æ–­ï¼ˆç”Ÿæˆï¼‰æœŸé—´ï¼Œæˆ‘ä»¬åˆ™ä¼šå°†ä¸Šä¸€æ¬¡çš„è¾“å‡ºä½œä¸ºæ–°çš„è¾“å…¥ï¼ˆä½¿ç”¨éšæœºçš„ token ä½œä¸ºç¬¬ä¸€ä¸ªè¾“å…¥ï¼‰ã€‚</p>
<p>å¯¹äºæ–‡æœ¬æ•°æ®æ¥è¯´ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›é¢„å¤„ç†ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª GitHub ä»“åº“æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p><strong>è¾“å…¥æ ·ä¾‹</strong>ï¼šHello there Charlie, how are you? Today I want a nice day. All I want for myself is a car.</p>
<ul>
<li>DATA_SIZEï¼šè¾“å…¥çš„é•¿åº¦ï¼Œå³ <code>len(input)</code>ï¼›</li>
<li>BATCH_SIZEï¼šæ¯æ‰¹çš„åºåˆ—ä¸ªæ•°ï¼›</li>
<li>NUM_STEPSï¼šæ¯ä¸ªåˆ‡ç‰‡çš„ token æ•°ï¼Œå³åºåˆ—çš„é•¿åº¦ <code>seq_len</code>ï¼›</li>
<li>STATE_SIZEï¼šæ¯ä¸ªéšå±‚çŠ¶æ€çš„éšå±‚èŠ‚ç‚¹æ•°ï¼Œå³å€¼ <code>H</code>ï¼›</li>
<li>num_batchesï¼šæ•°æ®é›†å°æ‰¹é‡åŒ–åçš„æ‰¹é‡æ•°</li>
</ul>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d30342d61742d362d31352d35372d616d2e706e673f773d363230.png" alt=""></p>
<p><strong>æ³¨æ„ï¼š</strong>ç”±äºæˆ‘ä»¬æ˜¯ä¸€è¡Œä¸€è¡Œçš„å°†æ•°æ®è¾“å…¥è¿› RNN å•å…ƒçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€åˆ—ä¸€åˆ—çš„å°†æ•°æ®ç»„æˆå¼ é‡è¾“å…¥åˆ°ç½‘ç»œä¸­å»ï¼Œå³æˆ‘ä»¬å¿…é¡»æŠŠåŸå§‹æ•°æ®è¿›è¡Œ reshape å¤„ç†ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå­—æ¯éƒ½å°†ä½œä¸ºä¸€ä¸ªè¢«åµŒå…¥çš„ç‹¬çƒ­ç¼–ç ï¼ˆone-hot encodingï¼Œè¯‘æ³¨ï¼šåˆç§° 1-of-k encodingï¼‰çš„å‘é‡è¾“å…¥ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯ä¸ªå¥å­æ•°æ®éƒ½è¢«å®Œç¾çš„åˆ‡åˆ†è¿›äº†ä¸€ç»„ç»„å°æ‰¹é‡æ•°æ®ï¼Œè¿™åªä¸è¿‡æ˜¯ä¸ºäº†è¾¾åˆ°æ›´å¥½çš„å¯è§†åŒ–ç›®çš„ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°è¾“å…¥æ˜¯æ€æ ·è¢«åˆ‡åˆ†çš„äº†ã€‚åœ¨å®é™…çš„ -RNN å®ç°ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒä¸€ä¸ªå…·ä½“çš„å¥å­ï¼Œæˆ‘ä»¬åªæ˜¯å°†æ•´ä¸ªè¾“å…¥åˆ‡åˆ†æˆ num_batches ä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡å½¼æ­¤ç‹¬ç«‹ï¼Œæ‰€ä»¥æ¯ä¸ªè¾“å…¥çš„é•¿åº¦éƒ½æ˜¯ <code>num_steps</code>ï¼Œå³ <code>seq_len</code>ã€‚</p>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d30342d61742d362d33302d31372d616d2e706e673f773d363230.png" alt=""></p>
<h2 id="ä¸‰ã€åå‘ä¼ æ’­"><a href="#ä¸‰ã€åå‘ä¼ æ’­" class="headerlink" title="ä¸‰ã€åå‘ä¼ æ’­"></a>ä¸‰ã€åå‘ä¼ æ’­</h2><p>RNN ç‰ˆæœ¬çš„åå‘ä¼ æ’­ BPTT åˆšå¼€å§‹å¯èƒ½æœ‰ç‚¹æ··ä¹±ï¼Œå°¤å…¶æ˜¯è®¡ç®—éšè—çŠ¶æ€å¯¹è¾“å…¥çš„å½±å“ä¹‹æ—¶ã€‚ä¸‹é¢çš„ä»£ç ä½¿ç”¨åŸç”Ÿ numpy å®ç°ï¼Œç¬¦åˆä¸‹å›¾ä¸­æˆ‘çš„å…¬å¼æ¨å¯¼é€»è¾‘ã€‚</p>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d30342d61742d362d33332d33372d616d2e706e673f773d363230.png" alt=""></p>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d30342d61742d362d33352d32392d616d312e706e673f773d363230.png" alt=""></p>
<p><strong>å‰å‘ä¼ æ’­ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> xrange(len(inputs)):</span><br><span class="line">    xs[t] = np.zeros((vocab_size,<span class="number">1</span>)) <span class="comment"># ç‹¬çƒ­ç¼–ç </span></span><br><span class="line">    xs[t][inputs[t]] = <span class="number">1</span></span><br><span class="line">    hs[t] = np.tanh(np.dot(Wxh, xs[t]) + np.dot(Whh, hs[t<span class="number">-1</span>]) + bh) <span class="comment"># éšè—çŠ¶æ€</span></span><br><span class="line">    ys[t] = np.dot(Why, hs[t]) + by <span class="comment"># ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æœªå½’ä¸€åŒ–å¯¹æ•°ä¼¼ç„¶æ¦‚ç‡</span></span><br><span class="line">    ps[t] = np.exp(ys[t]) / np.sum(np.exp(ys[t])) <span class="comment"># ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æ¦‚ç‡</span></span><br><span class="line">    loss += -np.log(ps[t][targets[t],<span class="number">0</span>]) <span class="comment"># softmaxï¼ˆäº¤å‰ç†µæŸå¤±ï¼‰</span></span><br></pre></td></tr></table></figure>

<p><strong>åå‘ä¼ æ’­:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> reversed(xrange(len(inputs))):</span><br><span class="line">    dy = np.copy(ps[t])</span><br><span class="line">    dy[targets[t]] -= <span class="number">1</span></span><br><span class="line">    dWhy += np.dot(dy, hs[t].T)</span><br><span class="line">    dby += dy</span><br><span class="line">    dh = np.dot(Why.T, dy) + dhnext  <span class="comment"># åå‘ä¼ æ’­ç»™ h</span></span><br><span class="line">    dhraw = (<span class="number">1</span> - hs[t] * hs[t]) * dh <span class="comment"># é€šè¿‡ tanh çš„éçº¿æ€§è¿›è¡Œåå‘ä¼ æ’­</span></span><br><span class="line">    dbh += dhraw</span><br><span class="line">    dWxh += np.dot(dhraw, xs[t].T)</span><br><span class="line">    dWhh += np.dot(dhraw, hs[t<span class="number">-1</span>].T)</span><br><span class="line">    dhnext = np.dot(Whh.T, dhraw)</span><br></pre></td></tr></table></figure>

<h2 id="å¼ é‡çš„å½¢çŠ¶"><a href="#å¼ é‡çš„å½¢çŠ¶" class="headerlink" title="å¼ é‡çš„å½¢çŠ¶"></a>å¼ é‡çš„å½¢çŠ¶</h2><p>åœ¨å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¼ é‡çš„å½¢çŠ¶ã€‚åœ¨è¿™ä¸ª CHAR-RNN çš„ä¾‹å­ä¸Šè®²è¿°å¼ é‡å½¢çŠ¶è¿™ä¸ªæ¦‚å¿µæœ‰ç‚¹å¥‡æ€ªï¼Œå› æ­¤æˆ‘ä¼šå‘ä½ è§£é‡Šå¦‚ä½•å¯¹å…¶è¿›è¡Œæ‰¹é‡åŒ–ä»¥åŠå®ƒä»¬æ˜¯æ€æ ·å®Œæˆ seq2seq ä»»åŠ¡çš„ã€‚</p>
<p><img src="https://picreso.oss-cn-beijing.aliyuncs.com/68747470733a2f2f7468656e657572616c70657273706563746976652e66696c65732e776f726470726573732e636f6d2f323031362f31302f73637265656e2d73686f742d323031362d31302d33312d61742d382d34352d30372d706d2e706e673f773d363230.png" alt=""></p>
<p>è¿™ä¸ªä»»åŠ¡å¯¹äºä¸€æ¬¡æ€§è¾“å…¥æ•´è¡Œï¼ˆå…¨éƒ¨ <code>batch_size</code> ä¸ªåºåˆ—çš„ï¼‰<code>seq_len</code> è¿™ç‚¹ä¸Šæœ‰ç‚¹å¥‡æ€ªã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¸€æ¬¡åªä¼ é€’ä¸€ä¸ªæ‰¹é‡ï¼Œæ¯ä¸ªæ‰¹é‡éƒ½æœ‰ <code>batch_size</code> ä¸ªåºåˆ—ï¼Œæ‰€ä»¥å½¢çŠ¶ä¸º<code>(batch_size, seq_len)</code>ã€‚æˆ‘ä»¬é€šå¸¸ä¹Ÿä¸ä¼šç”¨ <code>seq_len</code> æ¥åšåˆ†å‰²ï¼Œè€Œæ˜¯å–æ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚å¯¹äº seq2seq ä»»åŠ¡è€Œè¨€ï¼Œæœ¬ç³»åˆ—çš„ç¬¬ 2ã€3 å’Œ 5 ç¯‡æ–‡ç« ä¸­çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼šå°†å¤§å°ä¸º <code>batch_size</code> ä¸€ä¸ªæ‰¹é‡çš„åºåˆ—ä½œä¸ºè¾“å…¥ï¼Œå…¶ä¸­æ¯ä¸ªåºåˆ—çš„é•¿åº¦ä¸º<code>seq_len</code> ã€‚æˆ‘ä»¬ä¸èƒ½åƒåœ¨å›¾ä¸­é‚£æ ·æŒ‡å®š <code>seq_len</code>ï¼Œå› ä¸ºå®é™…çš„<code>seq_len</code> ä¼šæ ¹æ®å…¨éƒ¨æ ·æœ¬çš„ç‰¹ç‚¹å¡«å……åˆ°æœ€å¤§å€¼ã€‚æˆ‘ä»¬ä¼šåœ¨æ¯”æœ€å¤§é•¿åº¦çŸ­çš„æ‰€æœ‰å¥å­åå¡«å……ä¸€äº›å¡«å……ç¬¦ï¼Œä»è€Œè¾¾åˆ°æœ€å¤§å€¼ã€‚ä¸è¿‡ç°åœ¨è¿˜ä¸æ˜¯æ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜çš„æ—¶å€™ã€‚</p>
<h2 id="å››ã€Char-RNN-çš„-TensorFlow-å®ç°ï¼ˆæ— -RNN-æŠ½è±¡ï¼‰"><a href="#å››ã€Char-RNN-çš„-TensorFlow-å®ç°ï¼ˆæ— -RNN-æŠ½è±¡ï¼‰" class="headerlink" title="å››ã€Char-RNN çš„ TensorFlow å®ç°ï¼ˆæ—  RNN æŠ½è±¡ï¼‰"></a>å››ã€Char-RNN çš„ TensorFlow å®ç°ï¼ˆæ—  RNN æŠ½è±¡ï¼‰</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨æ²¡æœ‰ RNN ç±»æŠ½è±¡çš„çº¯ TensorFlow è¿›è¡Œå®ç°ã€‚åŒæ—¶è¿˜å°†ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„æƒé‡é›†æ¥çœŸæ­£ç†è§£è¾“å…¥æ•°æ®çš„æµå‘ä»¥åŠè¾“å‡ºæ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºä»£ç é‡Œä¸€äº›é‡ç‚¹éƒ¨åˆ†ï¼Œè€Œå®Œæ•´çš„ä»£ç æˆ‘å°†ç»™å‡ºç›¸å…³é“¾æ¥ã€‚å¦‚æœä½ æƒ³è¦ä½¿ç”¨ TF RNN ç±»è¿›è¡Œå®ç°ï¼Œè¯·è½¬åˆ°æœ¬æ–‡ç¬¬äº”å°èŠ‚ã€‚</p>
<p><strong>é‡ç‚¹ï¼š</strong></p>
<p>é¦–å…ˆæˆ‘æƒ³è®¨è®ºä¸‹å¦‚ä½•ç”Ÿæˆæ‰¹é‡åŒ–çš„æ•°æ®ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤ï¼Œé‚£å°±æ˜¯å°†æ•°æ®è¿›è¡Œæ‰¹é‡åŒ–å¤„ç†ï¼Œç„¶åå†å°†æ•°æ®åˆ†å‰²è¿› <code>seq_len</code>ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†æ¶ˆé™¤ RNN ç»“æ„ä¸­ BPTT ç®—æ³•ä¸­äº§ç”Ÿçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åŒæ—¶å¤„ç†å¤šä¸ªå­—ç¬¦ã€‚è¿™æ˜¯å› ä¸ºåœ¨åå‘ä¼ æ’­ä¸­ï¼Œå¦‚æœåºåˆ—å¤ªé•¿ï¼Œæ¢¯åº¦å°±ä¼šä¸‹é™å¾—å¾ˆå¿«ã€‚å› æ­¤ï¼Œä¸€ä¸ªç®€å•çš„æŠ€å·§æ˜¯ä¿å­˜ä¸€ä¸ª <code>seq_len</code> é•¿åº¦çš„è¾“å‡ºçŠ¶æ€ï¼Œç„¶åå°†å…¶ä½œä¸ºä¸‹ä¸€ä¸ª <code>seq_len</code> çš„ <code>initial_state</code>ã€‚è¿™ç§ç”±æˆ‘ä»¬è‡ªè¡Œé€‰æ‹©ï¼ˆä½¿ç”¨ BPTT æ¥ï¼‰å¤„ç†çš„ä¸ªæ•°å’Œæ›´æ–°é¢‘ç‡çš„åšæ³•ï¼Œå°±æ˜¯æ‰€è°“çš„æˆªæ–­åå‘ä¼ æ’­ï¼ˆtruncated backpropagationï¼‰ã€‚<code>initial_state</code> ä» 0 å¼€å§‹ï¼Œå¹¶åœ¨æ¯è½®è®¡ç®—ä¸­è¿›è¡Œé‡ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½åœ¨ä¸€ä¸ªç‰¹å®šçš„æ‰¹æ¬¡ä¸­ä»ä¹‹å‰çš„ <code>seq_len</code> åºåˆ—é‡Œä¿å­˜è¡¨ç¤ºçš„æŸäº›ç±»å‹ã€‚è¿™ä¹ˆåšçš„åŸå› åœ¨äºï¼Œåœ¨å­—ç¬¦è¿™ç§çº§åˆ«ä¸Šï¼Œä¸€ä¸ªæå°çš„åºåˆ—å¹¶ä¸èƒ½å¤Ÿå­¦ä¹ åˆ°è¶³å¤Ÿå¤šçš„è¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_batch</span><span class="params">(FLAGS, raw_data)</span>:</span></span><br><span class="line">    raw_X, raw_y = raw_data</span><br><span class="line">    data_length = len(raw_X)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»åŸå§‹æ•°æ®ä¸­åˆ›å»ºæ‰¹é‡æ•°æ®</span></span><br><span class="line">    num_batches = FLAGS.DATA_SIZE // FLAGS.BATCH_SIZE <span class="comment"># æ¯æ‰¹çš„ token</span></span><br><span class="line">    data_X = np.zeros([num_batches, FLAGS.BATCH_SIZE], dtype=np.int32)</span><br><span class="line">    data_y = np.zeros([num_batches, FLAGS.BATCH_SIZE], dtype=np.int32)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_batches):</span><br><span class="line">        data_X[i, :] = raw_X[FLAGS.BATCH_SIZE * i: FLAGS.BATCH_SIZE * (i+<span class="number">1</span>)]</span><br><span class="line">        data_y[i, :] = raw_y[FLAGS.BATCH_SIZE * i: FLAGS.BATCH_SIZE * (i+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°½ç®¡æ¯ä¸ªæ‰¹æ¬¡éƒ½æœ‰å¾ˆå¤šçš„ token</span></span><br><span class="line">    <span class="comment"># ä½†æˆ‘ä»¬æ¯æ¬¡åªæƒ³è¾“å…¥ seq_len ä¸ª token</span></span><br><span class="line">    feed_size = FLAGS.BATCH_SIZE // FLAGS.SEQ_LEN</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(feed_size):</span><br><span class="line">        X = data_X[:, i * FLAGS.SEQ_LEN:(i+<span class="number">1</span>) * FLAGS.SEQ_LEN]</span><br><span class="line">        y = data_y[:, i * FLAGS.SEQ_LEN:(i+<span class="number">1</span>) * FLAGS.SEQ_LEN]</span><br><span class="line">        <span class="keyword">yield</span> (X, y)</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„æƒé‡çš„ä»£ç ã€‚<code>rnn_cell</code> å‡½æ•°ç”¨æ¥æ¥æ”¶æ¥è‡ªå‰ä¸€ä¸ªå•å…ƒçš„è¾“å…¥å’ŒçŠ¶æ€ï¼Œä»è€Œç”Ÿæˆ RNN çš„è¾“å‡ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸‹ä¸€ä¸ªå•å…ƒçš„è¾“å…¥çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªå‡½æ•° <code>rnn_logits</code> ä½¿ç”¨æƒé‡å°†æˆ‘ä»¬çš„ RNN è¾“å‡ºè¿›è¡Œè½¬æ¢ï¼Œä»è€Œé€šè¿‡ softmax ç”Ÿæˆ logits æ¦‚ç‡å¹¶ç”¨äºåˆ†ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnn_cell</span><span class="params">(FLAGS, rnn_input, state)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_cell'</span>, reuse=<span class="literal">True</span>):</span><br><span class="line">        W_input = tf.get_variable(<span class="string">'W_input'</span>,</span><br><span class="line">            [FLAGS.NUM_CLASSES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">        W_hidden = tf.get_variable(<span class="string">'W_hidden'</span>,</span><br><span class="line">            [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">        b_hidden = tf.get_variable(<span class="string">'b_hidden'</span>, [FLAGS.NUM_HIDDEN_UNITS],</span><br><span class="line">            initializer=tf.constant_initializer(<span class="number">0.0</span>))</span><br><span class="line">    <span class="keyword">return</span> tf.tanh(tf.matmul(rnn_input, W_input) +</span><br><span class="line">                   tf.matmul(state, W_hidden) + b_hidden)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnn_logits</span><span class="params">(FLAGS, rnn_output)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">'softmax'</span>, reuse=<span class="literal">True</span>):</span><br><span class="line">        W_softmax = tf.get_variable(<span class="string">'W_softmax'</span>,</span><br><span class="line">            [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_CLASSES])</span><br><span class="line">        b_softmax = tf.get_variable(<span class="string">'b_softmax'</span>,</span><br><span class="line">            [FLAGS.NUM_CLASSES], initializer=tf.constant_initializer(<span class="number">0.0</span>))</span><br><span class="line">    <span class="keyword">return</span> tf.matmul(rnn_output, W_softmax) + b_softmax</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†è¾“å…¥å’Œç‹¬çƒ­ç¼–ç åœ¨ RNN çš„æ‰¹å¤„ç†ä¸­è¿›è¡Œ reshape æ“ä½œã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>rnn_cell</code>ã€<code>rnn_logits</code> å’Œ softmax æ¥è¿è¡Œæˆ‘ä»¬çš„ RNN ä»è€Œé¢„æµ‹ä¸‹ä¸€ä¸ª token äº†ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç”Ÿæˆçš„çŠ¶æ€ä¸æˆ‘ä»¬åœ¨è¿™ä¸ªç®€å•å®ç°ä¸­çš„ RNN è¾“å‡ºæ˜¯ä¸€è‡´çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">model</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, FLAGS)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å ä½ç¬¦</span></span><br><span class="line">        self.X = tf.placeholder(tf.int32, [<span class="literal">None</span>, <span class="literal">None</span>],</span><br><span class="line">            name=<span class="string">'input_placeholder'</span>)</span><br><span class="line">        self.y = tf.placeholder(tf.int32, [<span class="literal">None</span>, <span class="literal">None</span>],</span><br><span class="line">            name=<span class="string">'labels_placeholder'</span>)</span><br><span class="line">        self.initial_state = tf.zeros([FLAGS.NUM_BATCHES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‡†å¤‡è¾“å…¥</span></span><br><span class="line">        X_one_hot = tf.one_hot(self.X, FLAGS.NUM_CLASSES)</span><br><span class="line">        rnn_inputs = [tf.squeeze(i, squeeze_dims=[<span class="number">1</span>]) \</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> tf.split(<span class="number">1</span>, FLAGS.SEQ_LEN, X_one_hot)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å®šä¹‰ RNN cell</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_cell'</span>):</span><br><span class="line">            W_input = tf.get_variable(<span class="string">'W_input'</span>,</span><br><span class="line">                [FLAGS.NUM_CLASSES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">            W_hidden = tf.get_variable(<span class="string">'W_hidden'</span>,</span><br><span class="line">                [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">            b_hidden = tf.get_variable(<span class="string">'b_hidden'</span>,</span><br><span class="line">                [FLAGS.NUM_HIDDEN_UNITS],</span><br><span class="line">                initializer=tf.constant_initializer(<span class="number">0.0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ›å»º RNN</span></span><br><span class="line">        state = self.initial_state</span><br><span class="line">        rnn_outputs = []</span><br><span class="line">        <span class="keyword">for</span> rnn_input <span class="keyword">in</span> rnn_inputs:</span><br><span class="line">            state = rnn_cell(FLAGS, rnn_input, state)</span><br><span class="line">            rnn_outputs.append(state)</span><br><span class="line">        self.final_state = rnn_outputs[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Logits æ¦‚ç‡åŠé¢„æµ‹</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">'softmax'</span>):</span><br><span class="line">            W_softmax = tf.get_variable(<span class="string">'W_softmax'</span>,</span><br><span class="line">                [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_CLASSES])</span><br><span class="line">            b_softmax = tf.get_variable(<span class="string">'b_softmax'</span>,</span><br><span class="line">                [FLAGS.NUM_CLASSES],</span><br><span class="line">                initializer=tf.constant_initializer(<span class="number">0.0</span>))</span><br><span class="line"></span><br><span class="line">        logits = [rnn_logits(FLAGS, rnn_output) <span class="keyword">for</span> rnn_output <span class="keyword">in</span> rnn_outputs]</span><br><span class="line">        self.predictions = [tf.nn.softmax(logit) <span class="keyword">for</span> logit <span class="keyword">in</span> logits]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸå¤±ä¸ä¼˜åŒ–</span></span><br><span class="line">        y_as_list = [tf.squeeze(i, squeeze_dims=[<span class="number">1</span>]) \</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> tf.split(<span class="number">1</span>, FLAGS.SEQ_LEN, self.y)]</span><br><span class="line">        losses = [tf.nn.sparse_softmax_cross_entropy_with_logits(logit, label) \</span><br><span class="line">            <span class="keyword">for</span> logit, label <span class="keyword">in</span> zip(logits, y_as_list)]</span><br><span class="line">        self.total_loss = tf.reduce_mean(losses)</span><br><span class="line">        self.train_step = tf.train.AdagradOptimizer(</span><br><span class="line">            FLAGS.LEARNING_RATE).minimize(self.total_loss)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¶å°”ä¹Ÿä¼šä»æ¨¡å‹ä¸­è¿›è¡Œé‡‡æ ·ã€‚å¯¹äºé‡‡æ ·è€Œè¨€ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ logits æ¦‚ç‡ä¸­çš„æœ€å¤§å€¼ï¼Œæˆ–è€…åœ¨é€‰æ‹©çš„ç±»åˆ«ä¸­å¼•å…¥ <code>temperature</code> å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sample</span><span class="params">(self, FLAGS, sampling_type=<span class="number">1</span>)</span>:</span></span><br><span class="line"></span><br><span class="line">    initial_state = tf.zeros([<span class="number">1</span>,FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">    predictions = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†é¢„è®¾ token</span></span><br><span class="line">    state = initial_state</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> FLAGS.START_TOKEN:</span><br><span class="line">        idx = FLAGS.char_to_idx[char]</span><br><span class="line">        idx_one_hot = tf.one_hot(idx, FLAGS.NUM_CLASSES)</span><br><span class="line">        rnn_input = tf.reshape(idx_one_hot, [<span class="number">1</span>, <span class="number">65</span>])</span><br><span class="line">        state =  rnn_cell(FLAGS, rnn_input, state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åœ¨é¢„è®¾ token åè¿›è¡Œé¢„æµ‹</span></span><br><span class="line">    logit = rnn_logits(FLAGS, state)</span><br><span class="line">    prediction = tf.argmax(tf.nn.softmax(logit), <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">    predictions.append(prediction.eval())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> token_num <span class="keyword">in</span> range(FLAGS.PREDICTION_LENGTH<span class="number">-1</span>):</span><br><span class="line">        idx_one_hot = tf.one_hot(prediction, FLAGS.NUM_CLASSES)</span><br><span class="line">        rnn_input = tf.reshape(idx_one_hot, [<span class="number">1</span>, <span class="number">65</span>])</span><br><span class="line">        state =  rnn_cell(FLAGS, rnn_input, state)</span><br><span class="line">        logit = rnn_logits(FLAGS, state)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹åˆ†å¸ƒè¿›è¡Œç¼©æ”¾</span></span><br><span class="line">        <span class="comment"># temperature è¶Šé«˜ï¼Œäº§ç”Ÿçš„æ–°è¯è¶Šå¤šï¼Œä¹Ÿå°±è¶Šç‚«é…·</span></span><br><span class="line">        <span class="comment"># ä½†åŒæ—¶ä¹Ÿéœ€è¦æ›´å¤šçš„æ ·æœ¬</span></span><br><span class="line">        next_char_dist = logit/FLAGS.TEMPERATURE</span><br><span class="line">        next_char_dist = tf.exp(next_char_dist)</span><br><span class="line">        next_char_dist /= tf.reduce_sum(next_char_dist)</span><br><span class="line"></span><br><span class="line">        dist = next_char_dist.eval()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å•å­—ç¬¦é‡‡æ ·</span></span><br><span class="line">        <span class="keyword">if</span> sampling_type == <span class="number">0</span>:</span><br><span class="line">            prediction = tf.argmax(tf.nn.softmax(</span><br><span class="line">                                    next_char_dist), <span class="number">1</span>)[<span class="number">0</span>].eval()</span><br><span class="line">        <span class="keyword">elif</span> sampling_type == <span class="number">1</span>:</span><br><span class="line">            prediction = FLAGS.NUM_CLASSES - <span class="number">1</span></span><br><span class="line">            point = random.random()</span><br><span class="line">            weight = <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, FLAGS.NUM_CLASSES):</span><br><span class="line">                weight += dist[<span class="number">0</span>][index]</span><br><span class="line">                <span class="keyword">if</span> weight &gt;= point:</span><br><span class="line">                    prediction = index</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Pick a valid sampling_type!"</span>)</span><br><span class="line">        predictions.append(prediction)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> predictions</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜éœ€è¦çœ‹çœ‹å¦‚ä½•å‘æ•°æ®æµä¸­ä¼ é€’ <code>initial_state</code> å‚æ•°ã€‚ä¸ºäº†é¿å…æ¢¯åº¦æ¶ˆå¤±çš„å‡ºç°ï¼Œæ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªåºåˆ—åï¼Œå®ƒå’Œ <code>final_state</code> éƒ½ä¼šè¢«æ›´æ–°ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å°†é›¶åˆå§‹çŠ¶æ€ä½œä¸ºèµ·å§‹çŠ¶æ€ï¼Œç„¶ååœ¨å°†è¿™ä¸ªçŠ¶æ€ä¼ é€’ç»™éšåçš„åºåˆ—ï¼Œå¹¶å°†å‰ä¸€ä¸ªåºåˆ—çš„ <code>final_state</code> ä½œä¸ºæ–°çš„è¾“å…¥çŠ¶æ€ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">state = np.zeros([FLAGS.NUM_BATCHES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step, (input_X, input_y) <span class="keyword">in</span> enumerate(epoch):</span><br><span class="line">	predictions, total_loss, state, _= model.step(sess, input_X,</span><br><span class="line">										 input_y, state)</span><br><span class="line">	training_losses.append(total_loss)</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€ä½¿ç”¨-TF-RNN-å®ç°"><a href="#äº”ã€ä½¿ç”¨-TF-RNN-å®ç°" class="headerlink" title="äº”ã€ä½¿ç”¨ TF RNN å®ç°"></a>äº”ã€ä½¿ç”¨ TF RNN å®ç°</h2><p>ä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ TensorFlow çš„ NN å·¥å…·æ¥åˆ›å»º RNN æŠ½è±¡ç±»ã€‚åœ¨ä½¿ç”¨è¿™äº›ç±»ä¹‹å‰ï¼Œç†è§£è¿™äº›ç±»çš„è¾“å…¥å†…å®¹ã€å†…éƒ¨æ“ä½œåŠè¾“å‡ºç»“æœæ˜¯å¾ˆé‡è¦çš„ã€‚ç”±äºæˆ‘ä»¬ä»ç„¶æ˜¯ä½¿ç”¨åŸºæœ¬çš„ <code>rnn_cell</code>ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨æˆªæ–­è¯¯å·®åå‘ä¼ æ’­ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ GRU æˆ– LSTMï¼Œå°±æ²¡æœ‰å¿…è¦äº†ã€‚å…¶å®ï¼Œåªéœ€å°†æ•´ä¸ªæ•°æ®åˆ†å‰²æˆ <code>batch_size</code>ï¼Œç„¶åå¤„ç†æ•´ä¸ªåºåˆ—å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnn_cell</span><span class="params">(FLAGS)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å– cell ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> FLAGS.MODEL == <span class="string">'rnn'</span>:</span><br><span class="line">        rnn_cell_type = tf.nn.rnn_cell.BasicRNNCell</span><br><span class="line">    <span class="keyword">elif</span> FLAGS.MODEL == <span class="string">'gru'</span>:</span><br><span class="line">        rnn_cell_type = tf.nn.rnn_cell.GRUCell</span><br><span class="line">    <span class="keyword">elif</span> FLAGS.MODEL == <span class="string">'lstm'</span>:</span><br><span class="line">        rnn_cell_type = tf.nn.rnn_cell.BasicLSTMCell</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"Choose a valid RNN unit type."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•ä¸€ cell</span></span><br><span class="line">    single_cell = rnn_cell_type(FLAGS.NUM_HIDDEN_UNITS)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Dropout</span></span><br><span class="line">    single_cell = tf.nn.rnn_cell.DropoutWrapper(single_cell,</span><br><span class="line">        output_keep_prob=<span class="number">1</span>-FLAGS.DROPOUT)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¯ä¸ªçŠ¶æ€ä½œä¸ºå•ä¸ª cell</span></span><br><span class="line">    stacked_cell = tf.nn.rnn_cell.MultiRNNCell([single_cell] * FLAGS.NUM_LAYERS)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stacked_cell</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç åˆ›å»ºçš„æ˜¯æˆ‘ä»¬ç‰¹å®šçš„ RNN ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥ä»è®¸å¤šä¸åŒçš„ RNN å•å…ƒç±»å‹ä¸­è¿›è¡Œé€‰æ‹©ï¼Œä½†æ˜¯åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæœ€å¸¸è§çš„ç±»å‹ï¼ˆBasicRNNã€GRU å’Œ LSTMï¼‰ã€‚æˆ‘ä»¬ç”¨ä¸€å®šæ•°é‡çš„éšè—å•å…ƒæ¥åˆ›å»ºæ¯ä¸ª RNN å•å…ƒã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå•å…ƒå±‚ä¹‹åä¹‹åæ·»åŠ ä¸€ä¸ª Dropout å±‚æ¥è¿›è¡Œæ­£åˆ™åŒ–å¤„ç†ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤åˆ¶ <code>single_cell</code> æ¥å®ç°å †å çš„ RNN ç»“æ„ã€‚æ³¨æ„ï¼Œ<code>state_is_tuple=True</code> æ¡ä»¶è¢«é™„åŠ åˆ°äº† <code>single_cell</code> å’Œ <code>stacked_cell</code> é‡Œã€‚è¿™ä¿è¯äº†åœ¨ç»™å®šåºåˆ—çš„æ¯ä¸ªè¾“å…¥ä¹‹åè¿”å›ä¸€ä¸ªåŒ…å«çŠ¶æ€çš„å…ƒç»„ã€‚å¦‚æœä½¿ç”¨ LSTM å•å…ƒï¼Œä¸Šè¿°è¯­å¥ä¸ºçœŸï¼›å¦åˆ™æ— è§†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnn_inputs</span><span class="params">(FLAGS, input_data)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_inputs'</span>, reuse=<span class="literal">True</span>):</span><br><span class="line">        W_input = tf.get_variable(<span class="string">"W_input"</span>,</span><br><span class="line">            [FLAGS.NUM_CLASSES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &lt;BATCH_SIZE, seq_len, num_hidden_units&gt;</span></span><br><span class="line">    embeddings = tf.nn.embedding_lookup(W_input, input_data)</span><br><span class="line">    <span class="comment"># &lt;seq_len, BATCH_SIZE, num_hidden_units&gt;</span></span><br><span class="line">    <span class="comment"># BATCH_SIZE will be in columns bc we feed in row by row into RNN.</span></span><br><span class="line">    <span class="comment"># 1st row = 1st tokens from each batch</span></span><br><span class="line">    <span class="comment">#inputs = [tf.squeeze(i, [1]) for i in tf.split(1, FLAGS.SEQ_LEN, embeddings)]</span></span><br><span class="line">    <span class="comment"># NO NEED if using dynamic_rnn(time_major=False)</span></span><br><span class="line">    <span class="keyword">return</span> embeddings</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnn_softmax</span><span class="params">(FLAGS, outputs)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_softmax'</span>, reuse=<span class="literal">True</span>):</span><br><span class="line">        W_softmax = tf.get_variable(<span class="string">"W_softmax"</span>,</span><br><span class="line">            [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_CLASSES])</span><br><span class="line">        b_softmax = tf.get_variable(<span class="string">"b_softmax"</span>, [FLAGS.NUM_CLASSES])</span><br><span class="line"></span><br><span class="line">    logits = tf.matmul(outputs, W_softmax) + b_softmax</span><br><span class="line">    <span class="keyword">return</span> logits</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>rnn_inputs</code> å‡½æ•°ä¸åŸç”Ÿ TensorFlow ç‰ˆæœ¬çš„å®ç°ç”±ä¸€äº›ä¸åŒã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ reshape è¾“å…¥ã€‚è¿™æ˜¯å› ä¸º <code>tf.nn.dynamic_rnn</code> ä¼šå¸®æˆ‘ä»¬å¤„ç†æ¥è‡ª RNN çš„ output å’Œ stateã€‚è¿™æ˜¯ä¸€ç§æ•ˆç‡éå¸¸é«˜çš„ RNN æŠ½è±¡ï¼Œå®ƒè¿˜è¦æ±‚è¾“å…¥çš„æ•°æ®ä¸è¢«é¢„å…ˆ reshapeï¼Œå› æ­¤æˆ‘ä»¬æ‰€æœ‰å…¨éƒ¨å†…å®¹éƒ½æ˜¯åµŒå…¥çš„ã€‚<code>rnn_softmax</code> ç±»æä¾›çš„ logits åŠŸèƒ½å’Œå‰é¢æ‰€å®ç°å†…å®¹çš„å®Œå…¨ä¸€æ ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">model</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, FLAGS)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="string">''' æ•°æ®å ä½ç¬¦'''</span></span><br><span class="line">        self.input_data = tf.placeholder(tf.int32, [<span class="literal">None</span>, <span class="literal">None</span>])</span><br><span class="line">        self.targets = tf.placeholder(tf.int32, [<span class="literal">None</span>, <span class="literal">None</span>])</span><br><span class="line"></span><br><span class="line">        <span class="string">''' RNN å•å…ƒ '''</span></span><br><span class="line">        self.stacked_cell = rnn_cell(FLAGS)</span><br><span class="line">        self.initial_state = self.stacked_cell.zero_state(</span><br><span class="line">            FLAGS.NUM_BATCHES, tf.float32)</span><br><span class="line"></span><br><span class="line">        <span class="string">''' RNN è¾“å…¥ '''</span></span><br><span class="line">        <span class="comment"># åµŒå…¥æƒé‡ W_input)</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_inputs'</span>):</span><br><span class="line">            W_input = tf.get_variable(<span class="string">"W_input"</span>,</span><br><span class="line">                [FLAGS.NUM_CLASSES, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line">        inputs = rnn_inputs(FLAGS, self.input_data)</span><br><span class="line"></span><br><span class="line">        <span class="string">''' RNN è¾“å‡º '''</span></span><br><span class="line">        <span class="comment"># outputs: &lt;seq_len, BATCH_SIZE, num_hidden_units&gt;</span></span><br><span class="line">        <span class="comment"># state: &lt;BATCH_SIZE, num_layers*num_hidden_units&gt;</span></span><br><span class="line">        outputs, state = tf.nn.dynamic_rnn(cell=self.stacked_cell, inputs=inputs,</span><br><span class="line">                                           initial_state=self.initial_state)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># &lt;seq_len*BATCH_SIZE, num_hidden_units&gt;</span></span><br><span class="line">        outputs = tf.reshape(tf.concat(<span class="number">1</span>, outputs), [<span class="number">-1</span>, FLAGS.NUM_HIDDEN_UNITS])</span><br><span class="line"></span><br><span class="line">        <span class="string">''' å¤„ç† RNN è¾“å‡º '''</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn_softmax'</span>):</span><br><span class="line">            W_softmax = tf.get_variable(<span class="string">"W_softmax"</span>,</span><br><span class="line">                [FLAGS.NUM_HIDDEN_UNITS, FLAGS.NUM_CLASSES])</span><br><span class="line">            b_softmax = tf.get_variable(<span class="string">"b_softmax"</span>, [FLAGS.NUM_CLASSES])</span><br><span class="line">        <span class="comment"># Logit</span></span><br><span class="line">        self.logits = rnn_softmax(FLAGS, outputs)</span><br><span class="line">        self.probabilities = tf.nn.softmax(self.logits)</span><br><span class="line"></span><br><span class="line">        <span class="string">''' Loss '''</span></span><br><span class="line">        y_as_list = tf.reshape(self.targets, [<span class="number">-1</span>])</span><br><span class="line">        self.loss = tf.reduce_mean(</span><br><span class="line">            tf.nn.sparse_softmax_cross_entropy_with_logits(</span><br><span class="line">                self.logits, y_as_list))</span><br><span class="line">        self.final_state = state</span><br><span class="line"></span><br><span class="line">        <span class="string">''' ä¼˜åŒ– '''</span></span><br><span class="line">        self.lr = tf.Variable(<span class="number">0.0</span>, trainable=<span class="literal">False</span>)</span><br><span class="line">        trainable_vars = tf.trainable_variables()</span><br><span class="line">        <span class="comment"># æ¢¯åº¦æˆªæ–­é˜²æ­¢æ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸</span></span><br><span class="line">        grads, _ = tf.clip_by_global_norm(tf.gradients(self.loss, trainable_vars),</span><br><span class="line">                                          FLAGS.GRAD_CLIP)</span><br><span class="line">        optimizer = tf.train.AdamOptimizer(self.lr)</span><br><span class="line">        self.train_optimizer = optimizer.apply_gradients(</span><br><span class="line">            zip(grads, trainable_vars))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¿å­˜æ¨¡å‹çš„ç»„ä»¶</span></span><br><span class="line">        self.global_step = tf.Variable(<span class="number">0</span>, trainable=<span class="literal">False</span>)</span><br><span class="line">        self.saver = tf.train.Saver(tf.all_variables())</span><br></pre></td></tr></table></figure>

<p>è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šæ‰‹åŠ¨çš„åœ¨åµŒå…¥ä¹‹å‰å¯¹è¾“å…¥ token è¿›è¡Œç‹¬çƒ­ç¼–ç ï¼Œè¿™æ˜¯å› ä¸º<code>rnn_inputs</code> å‡½æ•°é‡Œçš„ <code>tf.nn.embedding_lookup</code> ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆã€‚</p>
<p>ä¸ºäº†ç”Ÿæˆè¾“å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>tf.nn.dynamic_rnn</code> ï¼Œå…¶è¾“å‡ºç»“æœä¸ºæ¯ä¸ªè¾“å…¥çš„è¾“å‡ºä»¥åŠè¿”å›çŠ¶æ€ï¼ˆå³åŒ…å«ä¸Šä¸€æ¬¡æ¯ä¸ªè¾“å…¥æ‰¹æ¬¡çš„çŠ¶æ€çš„å…ƒç»„ï¼‰ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¾“å‡ºè¿›è¡Œäº† reshape ï¼Œä»è€Œå¾—åˆ° logits æ¦‚ç‡å¹¶ç”¨äºä¸ targets è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æ³¨æ„åˆ° <code>self.initial_state</code> ç”± <code>stacked_cell.zero_state</code> åˆå§‹åŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‡å®šçš„ <code>batch_size</code> å°±å¤Ÿäº†ã€‚å¯¹äºè¿™é‡Œçš„ <code>NUM_BATCHES</code> è¯·æŸ¥çœ‹å‰é¢çš„å¼ é‡å½¢çŠ¶ä¸€èŠ‚ä¸­çš„è¯´æ˜ã€‚æœ‰ä¸€ç§æ›¿ä»£æ–¹æ³•å¯ä»¥ä¸åŒ…å«åˆå§‹çŠ¶æ€ï¼Œ<code>dynamic_rnn()</code> ä¼šè‡ªè¡Œå¤„ç†ï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯æŒ‡å®šæ•°æ®ç±»å‹ï¼ˆå³<code>dtype = tf.float32</code> ç­‰)ã€‚å¯æƒœæˆ‘ä»¬å¹¶ä¸èƒ½è¿™æ ·åšï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠåºåˆ—çš„ <code>final_state</code> ä½œä¸ºäº†ä¸‹ä¸€ä¸ªåºåˆ—çš„ <code>initial_state</code> ã€‚ä½ å¯èƒ½è¿˜ä¼šæ³¨æ„åˆ°ï¼Œå°½ç®¡ <code>self.initial_state</code> ä¸æ˜¯å ä½ç¬¦ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠå‰ä¸€æ¬¡ <code>final_state</code> ä¼ ç»™äº†æ–°çš„ <code>initial_state</code>ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡æ–°å®šä¹‰ <code>step()</code> é‡Œçš„ <code>self.initial_state</code> æ¥è¾“å…¥è‡ªå·±çš„åˆå§‹å€¼ã€‚ä¸ç®¡æ€æ ·ï¼Œä¸€æ—¦ç”¨åˆ° <code>input_feeds</code> ï¼Œæˆ‘ä»¬å°±éœ€è¦è®¡ç®— <code>output_feed</code>ï¼Œè€Œå¦‚æœæ²¡æœ‰ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè·³å›ä½¿ç”¨é‡è½½ä¹‹å‰çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ <code>stacked_cell.zero_state</code>ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">step</span><span class="params">(self, sess, batch_X, batch_y, initial_state=None)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> initial_state == <span class="literal">None</span>:</span><br><span class="line">        input_feed = &#123;self.input_data: batch_X,</span><br><span class="line">                      self.targets: batch_y&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        input_feed = &#123;self.input_data: batch_X,</span><br><span class="line">                      self.targets: batch_y,</span><br><span class="line">                      self.initial_state: initial_state&#125;</span><br><span class="line"></span><br><span class="line">    output_feed = [self.loss,</span><br><span class="line">                   self.final_state,</span><br><span class="line">                   self.logits,</span><br><span class="line">                   self.train_optimizer]</span><br><span class="line">    outputs = sess.run(output_feed, input_feed)</span><br><span class="line">    <span class="keyword">return</span> outputs[<span class="number">0</span>], outputs[<span class="number">1</span>], outputs[<span class="number">2</span>], outputs[<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç»“æœã€‚è¿™ç»ä¸æ˜¯ä¸€ç§æƒŠå¤©åŠ¨åœ°çš„åˆ›é€ ï¼Œä½†æˆ‘ç¡®å®æ˜¯ç”¨äº† <code>temperature</code> è€Œä¸æ˜¯ <code>argmax</code> è¿›è¡Œç”Ÿæˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”Ÿæˆç»“æœé‡ŒåŒ…å«å¾ˆå¤šæ–°å¥‡çš„åˆ›æ„ï¼Œä½†åŒæ—¶é”™è¯¯ä¹Ÿå¾ˆå¤šï¼ˆåŒ…æ‹¬è¯­æ³•ã€æ‹¼å†™ã€æ’åºç­‰ï¼‰ã€‚æˆ‘åªè®©ç½‘ç»œè®­ç»ƒäº† 10 è½®ï¼Œä½†å·²ç»å¼€å§‹çœ‹åˆ°å•è¯å’Œå¥å­ç»“æ„äº†ï¼Œç”šè‡³è¿˜èƒ½çœ‹åˆ°æ¯ä¸ªè§’è‰²çš„è¡¨æ¼”å°è¯ï¼ˆæ•°æ®é›†æ˜¯èå£«æ¯”äºšçš„ä½œå“ï¼‰ã€‚ä¸ºäº†è·å¾—ä¸é”™çš„ç»“æœï¼Œå¯ä»¥è®©å®ƒé€šå®µåœ¨ GPU ä¸Šè¿›è¡Œè®­ç»ƒã€‚</p>
<p>çœ‹åˆ°è¿™ï¼Œä¼°è®¡è¿èå£«æ¯”äºšéƒ½è¦ç»™è·ªäº†ã€‚</p>
<p><strong>æ›´æ–°</strong>ï¼šæˆ‘å¯¹å…¸å‹è¾“å…¥ã€è¾“å‡ºå’ŒçŠ¶æ€å¼ é‡çš„å½¢çŠ¶æœ‰å¾ˆå¤šç–‘é—®ã€‚</p>
<ul>
<li><strong>è¾“å…¥</strong>ï¼š[num_batches, seq_len, num_classes]</li>
<li><strong>è¾“å‡º</strong>ï¼š[num_batches, seq_len, num_hidden_units] ï¼ˆæ¯ä¸ªçŠ¶æ€çš„å…¨éƒ¨è¾“å‡ºï¼‰</li>
<li><strong>çŠ¶æ€</strong>ï¼š[num_batches, num_hidden_units] ï¼ˆä¸Šä¸€æ¬¡çŠ¶æ€çš„è¾“å‡ºï¼‰</li>
</ul>
<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¤„ç†å˜é•¿åºåˆ—ï¼Œå±•ç¤ºæ–‡æœ¬åˆ†ç±»çš„å…·ä½“å®ç°ã€‚</p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p><h4>Copyright Â© 2020 | Author: LiuXunzhuo | <a href="https://github.com/Xunzhuo/hexo-theme-coder" target="_blank" rel="noopener">Theme: Hexo-Coder</a></h4>
        <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="light">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>

</body>

</html>